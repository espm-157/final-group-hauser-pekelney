---
title: "fire.Rmd"
author: "Rachel Pekelney & Joshua Hauser"
date: "11/28/2021"
output: html_document
---

```{r options, include= FALSE, warning = FALSE}
library(tmap)      #interactive maps, raster + vector layers
library(terra)       # Successor to the raster library
library(tidyverse)   # our old friend
library(sf)   # to work with simple features (vector) data
library(rosm) # to work with OSM data
library(prettymapr)
library(yaps)
library(rgdal)
library(rgeos)
library(RColorBrewer)
```  

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Fire perimeters in the ICB
https://frap.fire.ca.gov/frap-projects/fire-perimeters/

```{r, results='hide}
dir.create("../data/fireperimeters")
download.file("https://frap.fire.ca.gov/media/50dgwqrb/fire20_1.zip", "../data/fireperimeters/fire20_1.zip")
unzip("../data/fireperimeters/fire20_1.zip", 
      exdir = "../data/fireperimeters/fireperimeters")
```

```{r}
#can filter by NPS and YNP easily I think. I think to get the ICB fires though we should just manually select them out of the table from "FIRE_NAME"
fireperimeters = st_read("../data/fireperimeters/fireperimeters/fire20_1.gdb")
```

```{r}
icb_fires = as.tibble(fireperimeters) %>%
  filter(UNIT_ID == "YNP") %>%
  filter(YEAR_ > 1971) %>%
  arrange(YEAR_)
icb_fires
```

```{r}
dir.create("../data/YosemiteVeg")
download.file("https://irma.nps.gov/DataStore/DownloadFile/599215", "../data/YosemiteVeg/599215")

unzip("../data/YosemiteVeg/599215", 
      exdir = "../data/YosemiteVeg/")
```

```{r}
# SomethinginYos = rast('../data/YosemiteVeg/yosegeodata/YOSE_VegPolys.lyr')
tm_shape("../data/YosemiteVeg/yosegeodata/YOSE_VegPolys.lyr") + tm_polygons()
```

```{r}
# Landsat rasters for 6/11/21
landsat_raster_b4 <- rast("LC08_L1TP_043034_20210704_20210713_02_T1_B4.TIF")
landsat_raster_b5 <- rast("LC08_L1TP_043034_20210704_20210713_02_T1_B5.TIF")

# projected so everything is in WGS 84 / UTM Zone 10N
icb_shp_nad83 <- st_read("ill_wtrshd_nad83.shp")
icb_shp <- st_transform(icb_shp_nad83, crs(landsat_raster_b4))
# confirming that it successfully reprojected 
st_crs(icb_shp)

band_list <- c(landsat_raster_b4, landsat_raster_b5)

# b4b5 <- stack(band_list)

landsat_ndvi <- (landsat_raster_b4 - landsat_raster_b5) / (landsat_raster_b5 + landsat_raster_b4)

icb_bbox <- st_bbox(c(xmin = 263981.057935, xmax = 289328.931675, ymax = 4181703.867149, ymin = 4159160.072076))


# plot the data

tm_shape(landsat_ndvi, bbox = st_bbox(icb_shp)) + tm_raster(midpoint = NA) + tm_shape(icb_shp) + tm_polygons(alpha=0)



```

```{r}
# NAIP raster
naip_raster <- rast('m_3711920_se_11_060_20200804.jp2')

#trying NDVI calculation
naip_multispectral_st <- stack(naip_raster)
naip_multispectral_br <- brick(naip_multispectral_st)

naip_ndvi <- (naip_multispectral_br[[4]] - naip_multispectral_br[[1]]) / (naip_multispectral_br[[4]] + naip_multispectral_br[[1]])

# plot the data
plot(naip_ndvi,
     main = "NDVI of Illilouette Creek Basin",
     axes = FALSE, box = FALSE)

```


Landsat 1-3 
Band 5 = red
Band 7 = NIR
date 9/16/1972

Landsat 8
Band 4 = red
Band 5 = NIR
need to find a cloud-free Sept. date
